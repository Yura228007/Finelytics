@page "/edit-transaction"
@rendermode Microsoft.AspNetCore.Components.Web.RenderMode.InteractiveServer
@inject NavigationManager Navigation
@inject HttpClient Http
<link href="app.css" rel="stylesheet" />
<div id="add-transaction-page">
    <div class="transaction-form-container">
        <h2 id="add-transaction-title">Добавить запись</h2>
        <input type="hidden" id="transaction-plan-id">
        Сделать динамический динамический рендеринг для категорий
        <select>
            <option value="value">text</option>
        </select>
        <div class="form-group">
            <label for="transaction-amount">Сумма:</label>
            <input @bind-value="transaction.PlannedAmmount" type="number" id="transaction-amount" name="transactionAmount" placeholder="0.00" required>
        </div>
        <div class="form-group">
            <label for="transaction-comment">Комментарий:</label>
            <input @bind-value="@transaction.Comment" id="transaction-comment" name="transactionComment" rows="3" placeholder="Например: Покупка продуктов"></input>
        </div>

        <div class="form-actions">
            <button @onclick="@(() => Edit())" class="btn-primary">Сохранить</button>
            <button @onclick="@(() => RedirectToPage($"transactions?user_id={Id}&plan_id={PlanId}"))" class="btn-secondary" id="cancel-transaction-btn">Отмена</button>
        </div>
    </div>
</div>

@code {
    [Parameter]
    [SupplyParameterFromQuery(Name = "user_id")]
    public int Id { get; set; } = -1;

    [Parameter]
    [SupplyParameterFromQuery(Name = "plan_id")]
    public int PlanId { get; set; } = -1;

    [Parameter]
    [SupplyParameterFromQuery(Name = "transaction_id")]
    public int TransactionId { get; set; } = -1;

    public Transaction transaction { get; set; } = new Transaction();
    public bool isRedirect { get; set; } = false;
    protected override async Task OnParametersSetAsync()
    {
        if(!isRedirect)
        {
            transaction = await Http.GetFromJsonAsync<Transaction>($"api/transactions/{TransactionId}");
        }
    }
    void RedirectToPage(string url)
    {
        isRedirect = true;
        Navigation.NavigateTo(url);
    }
    public void Edit()
    {
        if (!string.IsNullOrEmpty(transaction.Comment) && transaction.PlannedAmmount != 0)
        {
            transaction.PlanId = Id;
            TransactionsService.CurrentTransaction = transaction;
            isRedirect = true;
            // доделать, нужно чтобы был выбор категорий и у поля транзакции был ее id
            Navigation.NavigateTo($"transactions?user_id={Id}&plan_id={PlanId}&action=edit");
        }
    }
}
