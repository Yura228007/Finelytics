@page "/group-plan" // Принимает ID группы
@rendermode Microsoft.AspNetCore.Components.Web.RenderMode.InteractiveServer
@inject NavigationManager Navigation
@inject HttpClient Http
@inject PlansService PlansService
@inject GroupsService GroupsService

<link href="app.css" rel="stylesheet" />
<div id="group-plans-page">
    <header class="page-header">
        <button @onclick="@(() => RedirectToPage($"groups?user_id={Id}"))" class="btn-back">← Назад</button>
        <h1>План группы: @groupName</h1>
    </header>

    <main class="dashboard-content">
        <h2>Планы этой группы</h2>
        <div class="plans-table-container">
            <table id="plans-table">
                <thead>
                    <tr>
                        <th>Название плана</th>
                        <th>Срок</th>
                        <th>Статус</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                    @if (groupPlans != null && groupPlans.Any())
                    {
                        @foreach (Plan p in groupPlans)
                        {
                            <tr class="plan-row" data-plan-id="@p.Id">
                                <td class="plan-title">@p.Name</td>
                                <td class="plan-date-range">@p.StartDate.ToString("dd.mm.yyyy") - @p.EndDate.ToString("dd.mm.yyyy")</td>
                                <td class="plan-status">@GetStringFormEnablePlan(p)</td>
                                <td class="plan-actions">
                                    @* Здесь действия могут отличаться, например, редактирование может быть недоступно для всех *@
                                    <button @onclick="@(() => ViewPlanCategories(p.Id))" class="btn-details" data-plan-id="1">Категории</button>
                                    @* Кнопка "Закрыть план" или "Проанализировать" могут быть доступны только для создателя группы или администратора *@
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="4">В этой группе пока нет планов.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </main>
</div>

@code {
    [Parameter]
    [SupplyParameterFromQuery(Name = "user_id")]
    public int Id { get; set; }

    [Parameter]
    [SupplyParameterFromQuery(Name ="group_id")]
    public int GroupId { get; set; }
    void RedirectToPage(string url)
    {
        Navigation.NavigateTo(url);
    }
}