@page "/edit-category/{CategoryId:int}"
@rendermode Microsoft.AspNetCore.Components.Web.RenderMode.InteractiveServer
@inject NavigationManager Navigation

<link href="app.css" rel="stylesheet" />

<div id="edit-category-page">
    <div class="edit-category-container">
        <h2 id="edit-category-title">Редактирование категории</h2>

        @if (categoryToEdit == null)
        {
            <p>Загрузка данных категории...</p>
        }
        else
        {
            <div class="category-form">
                <div class="form-group">
                    <label class="category-name-label" for="category-name-input">Название категории:</label>
                    <input type="text" id="category-name-input" @bind="categoryToEdit.Name" class="form-control" required />

                    <label class="category-name" id="category-name-display">@categoryToEdit.Name</label>
                </div>

                <div class="form-group">
                    <label class="category-budget-label" for="category-budget-input">Бюджет:</label>
                    <input type="number" id="category-budget-input" @bind="categoryToEdit.Budget" class="form-control" required />

                    <label class="category-budget" id="category-budget-display">@categoryToEdit.Budget</label>
                </div>

                <div class="form-group">
                    <label class="category-spent-label" for="category-spent-input">Потрачено:</label>
                    <input type="number" id="category-spent-input" @bind="categoryToEdit.Spent" class="form-control" required readonly />

                    <label class="category-spent" id="category-spent-display">@categoryToEdit.Spent</label>
                </div>

                <div class="form-actions">
                    <button class="btn-save-category" @onclick="SaveCategory">Сохранить</button>
                    <button class="btn-cancel-edit" @onclick="CancelEdit">Отмена</button>
                </div>
            </div>
        }
    </div>
</div>

@code {
    [Parameter]
    public int CategoryId { get; set; }

    private Category categoryToEdit; // Предполагаем, что у вас есть класс Category

    protected override async Task OnInitializedAsync()
    {
        // Здесь нужно загрузить данные категории по CategoryId
        // Это пример, замените на вашу реальную логику доступа к данным (сервис, API и т.д.)
        categoryToEdit = await LoadCategoryData(CategoryId);

        if (categoryToEdit == null)
        {
            // Обработка случая, когда категория не найдена
            // Можно перенаправить пользователя или показать сообщение об ошибке
            Navigation.NavigateTo("/plan-categories"); // Возврат к списку категорий
        }
    }

    // Метод для симуляции загрузки данных категории
    private async Task<Category> LoadCategoryData(int id)
    {
        // В реальном приложении здесь будет вызов вашего сервиса для получения данных
        // Например: return await _categoryService.GetCategoryByIdAsync(id);

        // Имитация данных для примера:
        await Task.Delay(100); // Имитация асинхронной операции
        if (id == 1)
        {
            return new Category { Id = 1, Name = "Развлечения", Budget = 1000, Spent = 500 };
        }
        else if (id == 2)
        {
            return new Category { Id = 2, Name = "Продукты", Budget = 5000, Spent = 3200 };
        }
        return null; 
    }

    private async Task SaveCategory()
    {
        if (categoryToEdit != null)
        {
            // Здесь нужно сохранить измененные данные категории
            // Например: await _categoryService.UpdateCategoryAsync(categoryToEdit);

            // После сохранения возвращаемся на страницу со списком категорий
            Navigation.NavigateTo("/plan-categories");
        }
    }

    // Метод для отмены редактирования
    private void CancelEdit()
    {
        // Просто возвращаемся на страницу со списком категорий без сохранения
        Navigation.NavigateTo("/plan-categories");
    }

    // Предполагаемая модель Category
    public class Category
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public decimal Budget { get; set; }
        public decimal Spent { get; set; }
        // Возможно, другие свойства, связанные с планом
        public int PlanId { get; set; }
    }
}
